- name: install nginx
  apt:
    name: nginx-full
    state: present
    force: yes
  become: true

- set_fact:
    frontend_path: "{{ corr_path }}/corr-view/frontend"
    test_path: http://0.0.0.0/
    app_service_name: corrfrontend

- name: copy nginx template
  template: src={{ corr_path }}/builds/nginx-frontend.j2 dest=/etc/nginx/sites-available/{{ app_service_name }}
  become: true

- name: link files for nginx
  file: src=/etc/nginx/sites-available/{{ app_service_name }} dest=/etc/nginx/sites-enabled/{{ app_service_name }} state=link
  become: true

- name: restart nginx
  service: name=nginx state=restarted
  become: true

- name: check that the view is available
  uri: url={{ test_path }}
